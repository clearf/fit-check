services:
  claude:
    build:
      context: .
      dockerfile: Dockerfile
    image: claude-sandbox:latest
    container_name: claude-fitness

    # Pass secrets and config via environment variables.
    # Values come from the .env.docker file (see .env.docker.example).
    env_file:
      - .env.docker

    # Keep stdin open for interactive Claude sessions
    stdin_open: true
    tty: true

    # Resource limits appropriate for a CX23 (2 vCPU / 4GB RAM)
    deploy:
      resources:
        limits:
          memory: 2g
          cpus: "1.5"

    # ── Authentication volumes ─────────────────────────────────────────────────
    # Account login mode: uncomment the line below to mount your host Claude
    # credentials into the container. Run `claude login` on the host first.
    # Leave commented out when using ANTHROPIC_API_KEY in .env.docker instead.

    volumes:
       - ~/.claude.json:/home/claude/.claude.json:ro
       - ~/.screenrc:/home/claude/.screenrc:ro

    # Restart policy: keep running until explicitly stopped.
    # This allows detaching from screen and reattaching from any terminal.
    restart: unless-stopped
