services:
  claude:
    build:
      context: .
      dockerfile: Dockerfile
    image: claude-sandbox:latest
    container_name: claude-fitness

    # Pass secrets and config via environment variables.
    # Values come from the .env.docker file (see .env.docker.example).
    env_file:
      - .env.docker

    # Keep stdin open for interactive Claude sessions
    stdin_open: true
    tty: true

    # Resource limits appropriate for a CX23 (2 vCPU / 4GB RAM)
    deploy:
      resources:
        limits:
          memory: 2g
          cpus: "1.5"

    # ── Optional volume mounts ─────────────────────────────────────────────────
    # Uncomment lines below only if the source files exist on the host.
    # Docker will create directories (not files) for missing paths, breaking things.
    #
    # Account login mode (Option B auth): requires `claude login` on host first.
    # ~/.screenrc: only mount if you have a screenrc on this machine.
    volumes: []
    # volumes:
    #   - ~/.claude.json:/home/claude/.claude.json:ro
    #   - ~/.screenrc:/home/claude/.screenrc:ro

    # Restart policy: keep running until explicitly stopped.
    # This allows detaching from screen and reattaching from any terminal.
    restart: unless-stopped
